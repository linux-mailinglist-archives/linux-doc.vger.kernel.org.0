Return-Path: <linux-doc-owner@vger.kernel.org>
X-Original-To: lists+linux-doc@lfdr.de
Delivered-To: lists+linux-doc@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id 494E973F658
	for <lists+linux-doc@lfdr.de>; Tue, 27 Jun 2023 10:03:30 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S229647AbjF0ID2 (ORCPT <rfc822;lists+linux-doc@lfdr.de>);
        Tue, 27 Jun 2023 04:03:28 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:49958 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S230144AbjF0ID0 (ORCPT
        <rfc822;linux-doc@vger.kernel.org>); Tue, 27 Jun 2023 04:03:26 -0400
Received: from dfw.source.kernel.org (dfw.source.kernel.org [IPv6:2604:1380:4641:c500::1])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 0A10BE71
        for <linux-doc@vger.kernel.org>; Tue, 27 Jun 2023 01:03:25 -0700 (PDT)
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
        (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
         key-exchange X25519 server-signature RSA-PSS (2048 bits))
        (No client certificate requested)
        by dfw.source.kernel.org (Postfix) with ESMTPS id 8E6B261046
        for <linux-doc@vger.kernel.org>; Tue, 27 Jun 2023 08:03:24 +0000 (UTC)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id ED31CC433C0;
        Tue, 27 Jun 2023 08:03:23 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
        s=k20201202; t=1687853004;
        bh=CEaWLJzQks100urjohG2ZqxOALcUA1Rwzag471pm9Mo=;
        h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
        b=plpL/fzQgO/s2dC4jFT69z95l7hWC/BTHYm21jFIQTJGUXWuULztYJZCcRnwiD4yn
         MOsL22k9FdxTgveE/w8MSaGVgRu3s3EOSEuWSlLpTxex5/N4q3aOTw165ok81u/p8o
         NwVnCyVSxJAwW/Vwa8PI+vP5L4YOOlgjhsgZNljr7vy034cP2HFNwJubghxgTaGsmw
         /NlEXx7VYlFvGoeVQbaOtgz/KP3UzypNGPPz23YAE3zVfIg7GBPkLYMTds8IwIvpXx
         kgi/8ivXHxAfQtaSxAFpx546raZodaowrUN7QO5dSGMVREBClyKQORDZnZt19htZtB
         LnqkhPGHfk1PQ==
Received: from sofa.misterjones.org ([185.219.108.64] helo=goblin-girl.misterjones.org)
        by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        (Exim 4.95)
        (envelope-from <maz@kernel.org>)
        id 1qE3eL-008j6Z-QP;
        Tue, 27 Jun 2023 09:03:21 +0100
Date:   Tue, 27 Jun 2023 09:02:09 +0100
Message-ID: <86fs6dbaf2.wl-maz@kernel.org>
From:   Marc Zyngier <maz@kernel.org>
To:     "Lameter, Christopher" <cl@os.amperecomputing.com>
Cc:     "Russell King (Oracle)" <linux@armlinux.org.uk>,
        Ard Biesheuvel <ardb@kernel.org>,
        Quentin Perret <qperret@google.com>,
        Mark Rutland <mark.rutland@arm.com>,
        Catalin Marinas <catalin.marinas@arm.com>,
        Jonathan Corbet <corbet@lwn.net>,
        Will Deacon <will@kernel.org>,
        linux-arm-kernel@lists.infradead.org, linux-doc@vger.kernel.org
Subject: Re: [PATCH RFC 00/17] arm64 kernel text replication
In-Reply-To: <7ddd3c78-5392-9f8d-8f9-d898795c89@os.amperecomputing.com>
References: <ZHYCUVa8fzmB4XZV@shell.armlinux.org.uk>
        <ZH2lUj0zDWFppdJI@shell.armlinux.org.uk>
        <CAMj1kXHn0oho_CZMSc5N1updfdZDq+3VAfzw8kZqzzpTSgkXew@mail.gmail.com>
        <ZJW7kvWqLVZV4KVr@shell.armlinux.org.uk>
        <d18208d1ae12c81edd2830ac7ca7116a@kernel.org>
        <7ddd3c78-5392-9f8d-8f9-d898795c89@os.amperecomputing.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/28.2
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: cl@os.amperecomputing.com, linux@armlinux.org.uk, ardb@kernel.org, qperret@google.com, mark.rutland@arm.com, catalin.marinas@arm.com, corbet@lwn.net, will@kernel.org, linux-arm-kernel@lists.infradead.org, linux-doc@vger.kernel.org
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false
X-Spam-Status: No, score=-4.4 required=5.0 tests=BAYES_00,DKIMWL_WL_HIGH,
        DKIM_SIGNED,DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_MED,
        SPF_HELO_NONE,SPF_PASS,T_SCC_BODY_TEXT_LINE autolearn=ham
        autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-doc.vger.kernel.org>
X-Mailing-List: linux-doc@vger.kernel.org

On Tue, 27 Jun 2023 00:42:53 +0100,
"Lameter, Christopher" <cl@os.amperecomputing.com> wrote:
> 
> On Fri, 23 Jun 2023, Marc Zyngier wrote:
> 
> >> That sounds great, but my initial question would be whether, with such a
> >> setup, one could then run VMs under such a kernel without hardware that
> >> supports nested virtualisation? I suspect the answer would be no.
> > 
> > The answer is yes. All you need to do is to switch between the host
> > and guest stage-2s in the hypervisor, which is what KVM running in
> > protected mode does.
> 
> Well I think his point was that there are machines running without a
> hypervisor and kernel replication needs to work on that. We certainly
> benefit a lot from kernel replication and our customers may elect to
> run ARM64 kernels without hypervisors on bare metal.

These are not incompatible goals.

The hypervisor is a function that the user may want to enable or not.
Irrespective of that, the HW that underpins the virtualisation
functionality is available and allows you to solve this particular
problem in a different way. This doesn't preclude from running
bare-metal at all.

There is even precedent in using stage-2 to work around critical bugs
(the Socionext PCIe fiasco springs to mind).

	M.

-- 
Without deviation from the norm, progress is not possible.
